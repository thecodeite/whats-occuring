<body style="background-color: lightblue">
<canvas id=canvas width=210 height=210></canvas>
<div id=images />

<script>
  const canvas = document.getElementById('canvas')
  const images = document.getElementById('images')



  let pct = 0
  const interval = setInterval(draw, 100)
  function draw() {
    if (pct > 5000) return clearInterval(interval)

    const majPct = Math.floor(pct/50)
    const minPct = pct%50

    const start = Math.PI * 1.5
    const end = start + ((100-majPct) * Math.PI * 2)/100

    const size = canvas.width
    var segment = new Path2D();
    segment.moveTo(size/2, size/2);
    segment.arc(size/2, size/2, size*.38, start, end, true)

    let innerSegmentStart = Math.PI * 1.5
    let innerSegmentEnd = start

    if (minPct >= 50) {
      innerSegmentStart = 0
      innerSegmentEnd = Math.PI * 2
    } else if (minPct < 25) {
      innerSegmentEnd += ((50-(minPct*2)) * Math.PI * 2)/50
    } else if (minPct === 25) {
      innerSegmentStart = 0
      innerSegmentEnd = Math.PI * 2
    } else if (minPct < 50) {
      innerSegmentStart += ((50-(minPct*2)) * Math.PI * 2)/50
      innerSegmentEnd = Math.PI * 1.5
    } else {
      innerSegmentEnd += Math.PI * 2
      innerSegmentStart += ((50-minPct) * Math.PI * 2)/50
    }
    var innerSegment = new Path2D();
    innerSegment.moveTo(size/2, size/2);
    innerSegment.arc(size/2, size/2, size*.15, innerSegmentStart, innerSegmentEnd, true)


    var circle = new Path2D();
    circle.moveTo(size/2, size/2);
    circle.arc(size/2, size/2, size/4, 0, 2 * Math.PI);

    var track = new Path2D();
    track.moveTo(size/2, size/2);
    track.arc(size/2, size/2, size*.38, 0, 2 * Math.PI);

    var innerTrack = new Path2D();
    innerTrack.moveTo(size/2, size/2);
    innerTrack.arc(size/2, size/2, size*.15, 0, 2 * Math.PI);

    const  context = canvas.getContext('2d')

    context.clearRect(0, 0, size, size)


    context.fillStyle = `rgba(0, 0, 0, 0.2)`;
    context.fill(track)

    context.fillStyle = 'black'
    if (pct === 100) {
      context.fill(track)
    } else {
      context.fill(segment)
    }

    context.save()
    context.beginPath();
    context.arc(size/2, size/2, size*.2, 0, 2 * Math.PI);
    context.clip();
    //context.clearRect(0, 0, size, size)
    context.clearRect(size*.3, size*.3, size*.7, size*.7);
    context.closePath();
    context.restore()

    context.fillStyle = `rgba(0, 0, 0, 0.2)`;
    context.fill(innerTrack)

    context.fillStyle = 'black'
    if (pct === 100) {
      context.fill(track)
    } else {
      context.fill(innerSegment)
    }

    context.save()
    context.beginPath();
    context.arc(size/2, size/2, size*.1, 0, 2 * Math.PI);
    context.clip();
    //context.clearRect(0, 0, size, size)
    context.clearRect(size*.3, size*.3, size*.7, size*.7);
    context.closePath();
    context.restore()



    var dot = new Path2D();
    dot.moveTo(size/2, size/2);
    dot.arc(size/2, size/2, size*.03, 0, 2 * Math.PI);

    context.fillStyle = 'black'
    context.fill(dot)

    context.drawText

    const imageData = canvas.toDataURL("image/png");
    const img = document.createElement('img')
    img.setAttribute('src', imageData)
    img.setAttribute('title', `pct=${pct} start=${start} end=${end}`)
    //images.appendChild(img)

    // downloadURI(imageData, 'progress'+pct+'.png')
    pct += 1
  }

  function downloadURI(uri, name) {
    var link = document.createElement("a");
    link.download = name;
    link.href = uri;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    delete link;
  }

</script>